<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Get informal nature areas from OpenStreetMap — get_informalnature_osm • home2park</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Get informal nature areas from OpenStreetMap — get_informalnature_osm" />
<meta property="og:description" content="Download and process OpenStreetMap (OSM) 'informal nature' polygons within a specified geographical place,
from the Geofabrik database. It is a wrapper around
functions in the package osmextract, and
processes the downloaded files for subsequent analyses. Refer to package osmextract for
more details and options for input arguments when downloading the data." />
<meta property="og:image" content="https://ecological-cities.github.io/home2park/reference/figures/logo.png" />
<meta property="og:image:alt" content="Spatial Provision of Urban Parks" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@song_xiaoping" />
<meta name="twitter:site" content="https://xp-song.github.io" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NS9BX6B4CZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NS9BX6B4CZ');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">home2park</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/home2park.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/online/metric-comparisons.html">Park area provision: Metric comparisons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ecological-cities/home2park/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get informal nature areas from OpenStreetMap</h1>
    <small class="dont-index">Source: <a href='https://github.com/ecological-cities/home2park/blob/master/R/get_parks_osm.R'><code>R/get_parks_osm.R</code></a></small>
    <div class="hidden name"><code>get_informalnature_osm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Download and process OpenStreetMap (OSM) 'informal nature' polygons within a specified geographical <code>place</code>,
from the <a href='https://download.geofabrik.de'>Geofabrik database</a>. It is a wrapper around
functions in the package <a href='https://docs.ropensci.org/osmextract/index.html'><code>osmextract</code></a>, and
processes the downloaded files for subsequent analyses. Refer to package <code>osmextract</code> for
more details and options for input arguments when downloading the data.</p>
    </div>

    <pre class="usage"><span class='fu'>get_informalnature_osm</span><span class='op'>(</span>
  <span class='va'>place</span>,
  date <span class='op'>=</span> <span class='cn'>NULL</span>,
  mutually_exclusive_with <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  snap_tolerance <span class='op'>=</span> <span class='fl'>5</span>,
  min_area <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"m^2"</span><span class='op'>)</span>,
  min_trails <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"m"</span><span class='op'>)</span>,
  aggregate_polygons <span class='op'>=</span> <span class='fl'>15</span>,
  dir_raw <span class='op'>=</span> <span class='fu'>osmextract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/osmextract/reference/oe_download_directory.html'>oe_download_directory</a></span><span class='op'>(</span><span class='op'>)</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>place</th>
      <td><p><code>sf</code> object (with projected coordinate reference system). Geographical area to match with the (<code>.osm.pbf</code>) file in the data archive.
Argument passed to <code><a href='https://docs.ropensci.org/osmextract/reference/oe_match.html'>osmextract::oe_match()</a></code>.</p></td>
    </tr>
    <tr>
      <th>date</th>
      <td><p>Date of OSM data snapshot to download. Object of class "Date" in format <code>%Y-%m-%d</code>. Refer to https://download.geofabrik.de
for the specific dates available. Defaults to <code>NULL</code> (download the latest available data).</p></td>
    </tr>
    <tr>
      <th>mutually_exclusive_with</th>
      <td><p>list of <code>sf</code> object(s). This may be used to
ensure that polygons (e.g. parks, beaches, informal nature areas) are mutually-exclusive (i.e. non-overlapping).
Remove output polygons <a href='https://postgis.net/docs/ST_Contains.html'>contained</a> within, as well as <a href='https://postgis.net/docs/ST_Intersection.html'>intersections</a> between,
each element of this list. Should have the same coordinate reference system as <code>place</code>.</p></td>
    </tr>
    <tr>
      <th>snap_tolerance</th>
      <td><p>numeric. Argument for <code>tolerance</code> level passed to <code><a href='https://r-spatial.github.io/sf/reference/geos_binary_ops.html'>sf::st_snap()</a></code>,
used to rectify nearly coincident edges between polygons before processing (e.g. <code><a href='https://r-spatial.github.io/sf/reference/geos_binary_pred.html'>sf::st_contains()</a></code>, <code><a href='https://r-spatial.github.io/sf/reference/geos_binary_pred.html'>sf::st_covers()</a></code>).
Provided either as a units object (see <code><a href='https://rdrr.io/pkg/units/man/units.html'>units::set_units()</a></code>), or a number in the units of the coordinate reference system.
Defaults to <code>5</code>. Set to <code>0</code> if you do not wish to rectify minor overlaps.</p></td>
    </tr>
    <tr>
      <th>min_area</th>
      <td><p>numeric. Specify minimum area of each polygon to be retained in the output,
passed to argument <code>threshold</code> in <code><a href='https://strimas.com/smoothr/reference/drop_crumbs.html'>smoothr::drop_crumbs()</a></code>.
Provided either as a units object (see <code><a href='https://rdrr.io/pkg/units/man/units.html'>units::set_units()</a></code>), or a number in the units of
the coordinate reference system. Defaults to <code>0</code> m^2.</p></td>
    </tr>
    <tr>
      <th>min_trails</th>
      <td><p>numeric. Specify minimum length of OSM trail lines that has to be within
nature area polygons, for the polygons to be retained in the output.
Provided either as a units object (see <code><a href='https://rdrr.io/pkg/units/man/units.html'>units::set_units()</a></code>), or a number in the units of
the coordinate reference system. Defaults to <code>0</code> m.</p></td>
    </tr>
    <tr>
      <th>aggregate_polygons</th>
      <td><p>numeric. Argument for <code>dist</code> passed to <code><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>sf::st_buffer()</a></code>.
Buffered polygons that overlap will be aggregated into multipolygons.
Set to <code>NULL</code> if you do not wish to aggregate to multipolygons.</p></td>
    </tr>
    <tr>
      <th>dir_raw</th>
      <td><p>character. Directory to download the raw unprocessed OSM data. Passed to
argument <code>download_directory</code> in <code><a href='https://docs.ropensci.org/osmextract/reference/oe_read.html'>osmextract::oe_read()</a></code>.</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>character (optional). File path to export output data (GeoJSON format).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <code><a href='https://docs.ropensci.org/osmextract/reference/oe_read.html'>osmextract::oe_read()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The processed 'informal nature areas' (polygons) that are publicly accessible (<code>sf</code> object).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>OSM polygons are filtered by key-value attributes, where <code>landuse:</code> is <code>forest</code> or <code>meadow</code>,
or <code>natural:</code> is <code>wood</code>, <code>scrub</code>, <code>heath</code>, <code>grassland</code>, <code>wetland</code>, <code>marsh</code>, <code>fell</code> or <code>tundra</code>,
and <code>access:</code> is not <code>no</code>, <code>private</code> or <code>restricted</code>.
Polygons <a href='https://postgis.net/docs/ST_Contains.html'>contained</a> within <code>leisure:golf_course</code> are excluded after mutually-<a href='https://postgis.net/docs/ST_Snap.html'>snapping</a> vertices between the two
(see argument <code>snap_tolerance</code>). <a href='https://postgis.net/docs/ST_Intersection.html'>Intersections</a> with <code>landuse:military</code> polygons are also removed.
To exclude nature areas that are inaccessible, OSM trail lines are extracted (<code>highway:</code> is <code>track</code>, <code>path</code>, <code>footway</code> or <code>cycleway</code>,
and <code>access:</code> is not <code>no</code> or <code>private</code>). The remaining polygons without such trails <a href='https://postgis.net/docs/ST_Within.html'>within</a> their boundaries are removed.
If <code>mutually_exclusive_with</code> is provided, <a href='https://postgis.net/docs/ST_Intersection.html'>intersections</a> between
the output and these polygon(s) will be excluded using <code><a href='polygons_mutually_exclude.html'>polygons_mutually_exclude()</a></code>.
Polygons are then cleaned up using <code><a href='polygons_clean.html'>polygons_clean()</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pop_sgp</span><span class='op'>)</span>
<span class='va'>pop_sgp</span> <span class='op'>&lt;-</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='va'>pop_sgp</span>, <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='fl'>32648</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># transform to projected crs</span>

<span class='co'># merge all census blocks for chosen year (2020) into single multi-polygon</span>
<span class='co'># function requires that polygons are merged</span>
<span class='va'>city_boundaries</span> <span class='op'>&lt;-</span> <span class='va'>pop_sgp</span> <span class='op'>%&gt;%</span>
   <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>2020</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_combine.html'>st_union</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>smoothr</span><span class='fu'>::</span><span class='fu'><a href='https://strimas.com/smoothr/reference/fill_holes.html'>fill_holes</a></span><span class='op'>(</span>threshold <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>'km^2'</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> <span class='co'># clean up</span>
   <span class='fu'>smoothr</span><span class='fu'>::</span><span class='fu'><a href='https://strimas.com/smoothr/reference/drop_crumbs.html'>drop_crumbs</a></span><span class='op'>(</span>threshold <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>'km^2'</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/valid.html'>st_make_valid</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>parks_sgp</span><span class='op'>)</span> <span class='co'># to exclude nature areas within/intersecting these polygons</span>
<span class='va'>parks_sgp</span> <span class='op'>&lt;-</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='va'>parks_sgp</span>, <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='fl'>32648</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># transform to projected crs</span>

<span class='co'># run function</span>
<span class='fu'>get_informalnature_osm</span><span class='op'>(</span>place <span class='op'>=</span> <span class='va'>city_boundaries</span>,
                       date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>'2021-01-01'</span><span class='op'>)</span>,
                       mutually_exclusive_with <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>parks_sgp</span><span class='op'>)</span>,
                       snap_tolerance <span class='op'>=</span> <span class='fl'>5</span>,
                       min_area <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>2500</span>, <span class='st'>'m^2'</span><span class='op'>)</span>,
                       min_trails <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>'m'</span><span class='op'>)</span>,
                       aggregate_polygons <span class='op'>=</span> <span class='fl'>15</span>,
                       filename <span class='op'>=</span> <span class='st'>'nature-areas_osm-polygons_2021-01-01.geojson'</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://xp-song.github.io'>Xiao Ping Song</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


