<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate attributes per park polygon based on supplied data — parks_calc_attributes • home2park</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate attributes per park polygon based on supplied data — parks_calc_attributes"><meta property="og:description" content="Summaries will be calculated for each of the supplied datasets (data_points, data_lines, or data_rasters)
and appended to the parks data as additional columns.
Ensure that all have a (projected) coordinate reference system similar to parks."><meta property="og:image" content="https://ecological-cities.github.io/home2park/reference/figures/logo.png"><meta property="og:image:alt" content="Spatial Provision of Urban Parks"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@song_xiaoping"><meta name="twitter:site" content="https://xp-song.github.io"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NS9BX6B4CZ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NS9BX6B4CZ');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">home2park</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/home2park.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/online/metric-comparisons.html">Park area provision: Metric comparisons</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ecological-cities/home2park/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate attributes per park polygon based on supplied data</h1>
    <small class="dont-index">Source: <a href="https://github.com/ecological-cities/home2park/blob/HEAD/R/parks_calc_attributes.R" class="external-link"><code>R/parks_calc_attributes.R</code></a></small>
    <div class="hidden name"><code>parks_calc_attributes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Summaries will be calculated for each of the supplied datasets (<code>data_points</code>, <code>data_lines</code>, or <code>data_rasters</code>)
and appended to the <code>parks</code> data as additional columns.
Ensure that all have a (projected) coordinate reference system similar to <code>parks</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">parks_calc_attributes</span><span class="op">(</span>
  <span class="va">parks</span>,
  data_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  data_lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  data_rasters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  rasters_summarise_fun <span class="op">=</span> <span class="cn">NULL</span>,
  raster_min_patch_size <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"m^2"</span><span class="op">)</span>,
  raster_edge <span class="op">=</span> <span class="cn">NULL</span>,
  relative <span class="op">=</span> <span class="cn">TRUE</span>,
  filename <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>parks</dt>
<dd><p><code>sf</code> polygons (with projected coordinate reference system).</p></dd>
<dt>data_points</dt>
<dd><p>Named list of <code>sf</code> object(s) containing data of geometry type <code>POINT</code> or <code>MULTIPOINT</code>.
List names are used to name the park attributes (columns) in the output.</p></dd>
<dt>data_lines</dt>
<dd><p>Named list of <code>sf</code> object(s) containing data of geometry type <code>LINESTRING</code> or <code>MULTILINESTRING</code>.
List names are used to name the park attributes (columns) in the output.</p></dd>
<dt>data_rasters</dt>
<dd><p>Named list of single <code>SpatRaster</code> object(s) from <code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code>.
List names are used to name the park attributes (columns) in the output.</p></dd>
<dt>rasters_summarise_fun</dt>
<dd><p>Function to summarise the raster data passed to <code><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">terra::extract()</a></code>.
Defaults to <code>NULL</code>, which tabulates the sum of each unique value in the raster (i.e. classified raster,
with numbers each representing a specific class/category) using the function <code><a href="raster_class_area.html">raster_class_area()</a></code>.</p></dd>
<dt>raster_min_patch_size</dt>
<dd><p>Minimum patch size to be included when tabulating the sum of each raster class.
Only relevant if <code>rasters_summarise_fun = NULL</code>. Provided either as a units object (see <code><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">units::set_units()</a></code>),
or a number in the units of the coordinate reference system. Defaults to <code>0</code> m^2.</p></dd>
<dt>raster_edge</dt>
<dd><p>numeric. Option to calculate total edge length of (classified) raster(s)
associated with each of the <code>parks</code> polygons, using the function <code><a href="raster_edge_length.html">raster_edge_length()</a></code>. The total edge length of raster patches contained <a href="https://postgis.net/docs/ST_Within.html" class="external-link">within</a>
<code>parks</code> will be calculated, and patches in close proximity can be included by increasing the value of this argument;
the length of <code>parks</code> borders that <a href="https://postgis.net/docs/ST_Intersection.html" class="external-link">intersect</a> the buffered raster will be calculated.
This provides a way include patches in close proximity to the <code>parks</code> (e.g. total waterfront length close to parks).
Note that each class (unique value in the raster) will be summarised, including <code>0</code>; convert pixels to <code>NA</code> if you wish to exclude them.
Provided either as a units object (see <code><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">units::set_units()</a></code>),
or a number in the units of the coordinate reference system. Defaults to <code>NULL</code> (not calculated). Set to <code>0</code> to include patches
<a href="https://postgis.net/docs/ST_Within.html" class="external-link">within</a> <code>parks</code> only.</p></dd>
<dt>relative</dt>
<dd><p>logical. Whether or not to calculate relative amounts
(e.g. point density, ratio of line-to-perimeter length, proportional area). Defaults to <code>TRUE</code>.</p></dd>
<dt>filename</dt>
<dd><p>character (optional). File path to export output data (GeoJSON format).</p></dd>
<dt>...</dt>
<dd><p>Other arguments passed to <code><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">terra::extract()</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>parks</code> with added columns containing the summaries of basic park attributes
(area and perimeter), as well as summaries of each of the supplied datasets.
The summary method depends on geometry type (i.e. points, lines or rasters) and supplied arguments.
Some examples:</p><dl><dt>area</dt>
<dd><p>Area of park polygon.</p></dd>

<dt>perimeter</dt>
<dd><p>Perimeter of park polygon.</p></dd>

<dt>&lt; object name in <code>data_points</code> &gt;_count</dt>
<dd><p>Total count of points within park polygon.</p></dd>

<dt>&lt; object name in <code>data_points</code> &gt;_ptdensity</dt>
<dd><p>Total count divided by area of the park polygon (point density).
Included if argument <code>relative</code> set to <code>TRUE</code>.</p></dd>

<dt>&lt; object name in <code>data_lines</code> &gt;_length</dt>
<dd><p>Sum of line lengths within park polygon.</p></dd>

<dt>&lt; object name in <code>data_lines</code> &gt;_length_perim_ratio</dt>
<dd><p>Ratio of line-to-perimeter length of the park polygon.
Included if argument <code>relative</code> set to <code>TRUE</code>.</p></dd>

<dt>&lt; object name in <code>data_rasters</code> &gt;</dt>
<dd><p>Summarised values of a specific raster class
(depends on function provided in the <code>rasters_summarise_fun</code> argument).</p></dd>

<dt>&lt; object name in <code>data_rasters</code> &gt;&lt; class value &gt;_area</dt>
<dd><p>Total area of a specific raster class
(if <code>rasters_summarise_fun = NULL</code>).</p></dd>

<dt>&lt; object name in <code>data_rasters</code> &gt;&lt; class value &gt;_area_pct</dt>
<dd><p>Percentage area of a specific raster class
(if <code>rasters_summarise_fun = NULL</code>). Included if argument <code>relative</code> set to <code>TRUE</code>.</p></dd>

<dt>&lt; object name in <code>data_rasters</code> &gt;&lt; class value &gt;_length</dt>
<dd><p>Total edge length of a specific raster class.</p></dd>

<dt>&lt; object name in <code>data_rasters</code> &gt;&lt; class value &gt;_length_perim_ratio</dt>
<dd><p>Edge-to-perimeter length of a specific raster class.
Included if argument <code>relative</code> set to <code>TRUE</code>.</p></dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pop_sgp</span><span class="op">)</span> <span class="co"># city census blocks</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">parks_sgp</span><span class="op">)</span> <span class="co"># park polygons</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># transform to projected crs</span></span>
<span class="r-in"><span class="va">pop_sgp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pop_sgp</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">32648</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">parks_sgp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">parks_sgp</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">32648</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># get playground points (example attribute)</span></span>
<span class="r-in"><span class="va">city_boundaries</span> <span class="op">&lt;-</span> <span class="va">pop_sgp</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">   <span class="fu">smoothr</span><span class="fu">::</span><span class="fu"><a href="https://strimas.com/smoothr/reference/fill_holes.html" class="external-link">fill_holes</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'km^2'</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="co"># clean up</span></span>
<span class="r-in">   <span class="fu">smoothr</span><span class="fu">::</span><span class="fu"><a href="https://strimas.com/smoothr/reference/drop_crumbs.html" class="external-link">drop_crumbs</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'km^2'</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">playgrounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_playgrounds_osm.html">get_playgrounds_osm</a></span><span class="op">(</span>place <span class="op">=</span> <span class="va">city_boundaries</span>,</span>
<span class="r-in">                                   date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2021-01-01'</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">point_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">playgrounds</span><span class="op">)</span> <span class="co"># convert to list (can add other point data too)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">point_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"playground"</span><span class="op">)</span> <span class="co"># name each element in list</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># calculate playground point count &amp; density per park</span></span>
<span class="r-in"><span class="fu">parks_calc_attributes</span><span class="op">(</span>parks <span class="op">=</span> <span class="va">parks_sgp</span>,</span>
<span class="r-in">                      data_points <span class="op">=</span> <span class="va">point_list</span>,</span>
<span class="r-in">                      relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://xp-song.github.io" class="external-link">Xiao Ping Song</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

