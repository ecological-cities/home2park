<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Perform dasymetric mapping of (rasterised) population data — pop_dasymap • home2park</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Perform dasymetric mapping of (rasterised) population data — pop_dasymap" />
<meta property="og:description" content="Distribute population data per census block across inhabitable land as defined by land_relative_density.
Raster data provided should be a snapshot of the population for a single time period (e.g. a year),
created with other package functions (e.g. rasterise_pop(), rasterise_buildings()).
If there are multiple years present in the intermediate datasets, the user will have to extract the relevant list element for
the single year of interest (see examples). All input data should have a similar projected coordinate reference system
specific to the target area." />
<meta property="og:image" content="https://ecological-cities.github.io/home2park/reference/figures/logo.png" />
<meta property="og:image:alt" content="Spatial Provision of Urban Parks" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@song_xiaoping" />
<meta name="twitter:site" content="https://xp-song.github.io" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NS9BX6B4CZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NS9BX6B4CZ');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">home2park</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/home2park.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/online/metric-comparisons.html">Park area provision: Metric comparisons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ecological-cities/home2park/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform dasymetric mapping of (rasterised) population data</h1>
    <small class="dont-index">Source: <a href='https://github.com/ecological-cities/home2park/blob/master/R/pop_dasymap.R'><code>R/pop_dasymap.R</code></a></small>
    <div class="hidden name"><code>pop_dasymap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Distribute population data per census block across inhabitable land as defined by <code>land_relative_density</code>.
Raster data provided should be a snapshot of the population for a single time period (e.g. a year),
created with other package functions (e.g. <code><a href='rasterise_pop.html'>rasterise_pop()</a></code>, <code><a href='rasterise_buildings.html'>rasterise_buildings()</a></code>).
If there are multiple years present in the intermediate datasets, the user will have to extract the relevant list element for
the single year of interest (see examples). All input data should have a similar projected coordinate reference system
specific to the target area.</p>
    </div>

    <pre class="usage"><span class='fu'>pop_dasymap</span><span class='op'>(</span>
  <span class='va'>pop_polygons</span>,
  <span class='va'>pop_perblock_count</span>,
  <span class='va'>pop_perblock_density</span>,
  <span class='va'>land_relative_density</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  overwrite <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pop_polygons</th>
      <td><p><code>sf</code> polygons of the population data for a single time period.
May be extracted from the <code>pop_polygons</code> list element generated by <code><a href='rasterise_pop.html'>rasterise_pop()</a></code>.</p></td>
    </tr>
    <tr>
      <th>pop_perblock_count</th>
      <td><p>Raster of population count per census block for a single time period.
May be extracted from the <code>pop_count_rasters</code> list element generated by <code><a href='rasterise_pop.html'>rasterise_pop()</a></code>.</p></td>
    </tr>
    <tr>
      <th>pop_perblock_density</th>
      <td><p>Raster of population density per census block for a single time period.
May be extracted from the <code>pop_density_rasters</code> list element generated by <code><a href='rasterise_pop.html'>rasterise_pop()</a></code>.</p></td>
    </tr>
    <tr>
      <th>land_relative_density</th>
      <td><p>Raster of the relative density (e.g. suitability, habitability) of land for a single time period.
May be extracted from results generated by <code><a href='rasterise_buildings.html'>rasterise_buildings()</a></code> or <code><a href='rasterise_landuse.html'>rasterise_landuse()</a></code>.</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>character (optional). Export output raster to disk.</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>logical. Argument passed to <code><a href='https://rdrr.io/pkg/terra/man/writeRaster.html'>terra::writeRaster()</a></code>. If <code>TRUE</code>, <code>filename</code> is overwritten.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <code><a href='https://rdrr.io/pkg/terra/man/writeRaster.html'>terra::writeRaster()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Raster of population density, based on relative density values of the land defined in <code>land_relative_density</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pop_sgp</span><span class='op'>)</span> <span class='co'># population census block polygons</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>landuse_sgp</span><span class='op'>)</span> <span class='co'># land use polygons</span>


<span class='co'># transform to projected crs</span>
<span class='va'>pop_sgp</span> <span class='op'>&lt;-</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='va'>pop_sgp</span>, <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='fl'>32648</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>landuse_sgp</span> <span class='op'>&lt;-</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='va'>landuse_sgp</span>, <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='fl'>32648</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'># merge all census blocks for chosen year (2020) into single multi-polygon</span>
<span class='co'># function requires that polygons are merged</span>
<span class='va'>city_boundaries</span> <span class='op'>&lt;-</span> <span class='va'>pop_sgp</span> <span class='op'>%&gt;%</span>
   <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>2020</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_combine.html'>st_union</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>smoothr</span><span class='fu'>::</span><span class='fu'><a href='https://strimas.com/smoothr/reference/fill_holes.html'>fill_holes</a></span><span class='op'>(</span>threshold <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>'km^2'</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> <span class='co'># clean up</span>
   <span class='fu'>smoothr</span><span class='fu'>::</span><span class='fu'><a href='https://strimas.com/smoothr/reference/drop_crumbs.html'>drop_crumbs</a></span><span class='op'>(</span>threshold <span class='op'>=</span> <span class='fu'>units</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/units/man/units.html'>set_units</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>'km^2'</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
   <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/valid.html'>st_make_valid</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>buildings</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_buildings_osm.html'>get_buildings_osm</a></span><span class='op'>(</span>place <span class='op'>=</span> <span class='va'>city_boundaries</span>,
                               date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>'2021-01-01'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fl'>2020</span><span class='op'>)</span>


<span class='co'># rasterise population, landuse &amp; buildings</span>
<span class='va'>pop_rasters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rasterise_pop.html'>rasterise_pop</a></span><span class='op'>(</span><span class='va'>pop_sgp</span>,
                             census_block <span class='op'>=</span> <span class='st'>"subzone_n"</span>,
                             pop_count <span class='op'>=</span> <span class='st'>"pop_count"</span><span class='op'>)</span>

<span class='va'>landuse_rasters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rasterise_landuse.html'>rasterise_landuse</a></span><span class='op'>(</span><span class='va'>landuse_sgp</span>,
                                     land_use <span class='op'>=</span> <span class='st'>'lu_desc'</span>,
                                     subset <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'1'</span> <span class='op'>=</span> <span class='st'>'RESIDENTIAL'</span>,
                                                <span class='st'>'2'</span> <span class='op'>=</span> <span class='st'>'COMMERCIAL &amp; RESIDENTIAL'</span>,
                                                <span class='st'>'3'</span> <span class='op'>=</span> <span class='st'>'RESIDENTIAL WITH COMMERCIAL AT 1ST STOREY'</span>,
                                                <span class='st'>'4'</span> <span class='op'>=</span> <span class='st'>'RESIDENTIAL / INSTITUTION'</span><span class='op'>)</span>,
                                     sf_pop <span class='op'>=</span> <span class='va'>pop_sgp</span>,
                                     match_landuse_pop <span class='op'>=</span> <span class='st'>'recent'</span><span class='op'>)</span>

<span class='va'>buildings_rasters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rasterise_buildings.html'>rasterise_buildings</a></span><span class='op'>(</span><span class='va'>buildings</span>,
                                         proxy_pop_density <span class='op'>=</span> <span class='st'>'levels'</span>,
                                         year <span class='op'>=</span> <span class='st'>'year'</span>,
                                         sf_pop <span class='op'>=</span> <span class='va'>pop_sgp</span>,
                                         sf_landuse <span class='op'>=</span> <span class='va'>landuse_sgp</span>,
                                         match_buildings_pop <span class='op'>=</span> <span class='st'>'closest'</span><span class='op'>)</span>


<span class='co'># finally, perform dasymetric mapping on selected year (2020)</span>
<span class='va'>popdens_raster</span> <span class='op'>&lt;-</span> <span class='fu'>pop_dasymap</span><span class='op'>(</span>pop_polygons <span class='op'>=</span> <span class='va'>pop_rasters</span><span class='op'>$</span><span class='va'>pop_polygons</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,
                              pop_perblock_count <span class='op'>=</span> <span class='va'>pop_rasters</span><span class='op'>$</span><span class='va'>pop_count</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,
                              pop_perblock_density <span class='op'>=</span> <span class='va'>pop_rasters</span><span class='op'>$</span><span class='va'>pop_density</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,
                              land_relative_density <span class='op'>=</span> <span class='va'>buildings_rasters</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,
                              filename <span class='op'>=</span> <span class='st'>'buildings_popdensity.tif'</span>,
                              wopt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>gdal<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'COMPRESS=LZW'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://xp-song.github.io'>Xiao Ping Song</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


